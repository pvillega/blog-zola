<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://perevillega.com name=base><title>Software serves the Business • Monkey Island Battles and WebKit</title><link href=https://perevillega.com/icons/favicon.ico rel=icon type=image/png><link title="Software serves the Business - Atom Feed" href=https://perevillega.com/atom.xml rel=alternate type=application/atom+xml><link href="https://perevillega.com/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://perevillega.com/main.css?h=149ff9e737409b86f9c3" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=#087e96 name=theme-color><meta content="Have you heard about AWS Lambda? Do you like Monkey Island? Are you into Insult Sword Fighting? Then, come along, this may interest you ;)
…" name=description><meta content="Have you heard about AWS Lambda? Do you like Monkey Island? Are you into Insult Sword Fighting? Then, come along, this may interest you ;)
…" property=og:description><meta content="index, nofollow" name=robots><meta content="Monkey Island Battles and WebKit" property=og:title><meta content=article property=og:type><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" property=og:image><meta content=2088 property=og:image:width><meta content=1000 property=og:image:height><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" name=twitter:image><meta content=summary_large_image name=twitter:card><meta content=en_GB property=og:locale><meta content=https://perevillega.com/posts/monkey-island-battles-and-webkit/ property=og:url><meta content="Software serves the Business" property=og:site_name><meta content="default-src 'self';font-src 'self' data: 'self';img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self' 'unsafe-inline';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self' https://umami.villegawilcz.com;script-src 'self' https://umami.villegawilcz.com 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://perevillega.com/no_js.css rel=stylesheet></noscript><script src=https://perevillega.com/js/initializeTheme.min.js></script><script defer src=https://perevillega.com/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=7bdfa858-bebc-479d-9a1f-bea833a709a8 defer src=https://umami.villegawilcz.com/script.js></script><meta content=@pvillega@mastodon.social name=fediverse:creator><script src="https://perevillega.com/search_index.en.js?h=791a6da9678059241bea" defer></script><script src="https://perevillega.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://perevillega.com>Software serves the Business</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/posts/> blog </a><li><a class="nav-links no-hover-padding" href=https://perevillega.com/tags/> tags </a></li><div class=nav-navs id=menu-icons-group><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Monkey Island Battles and WebKit</h1><ul class=meta><li>25th Mar 2016<li title="760 words"><span aria-hidden=true class=separator>•</span>4 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://perevillega.com/tags/lambda/>lambda</a>, <li class=tag><a href=https://perevillega.com/tags/development/>development</a>, <li class=tag><a href=https://perevillega.com/tags/webkit/>webkit</a></ul><section class=body><p>Have you heard about <a href=http://docs.aws.amazon.com/lambda/latest/dg/welcome.html rel=noopener target=_blank>AWS Lambda</a>? Do you like <a href=https://en.wikipedia.org/wiki/Monkey_Island_(series) rel=noopener target=_blank>Monkey Island</a>? Are you into <a href=http://monkeyisland.wikia.com/wiki/Insult_Sword_Fighting rel=noopener target=_blank>Insult Sword Fighting</a>? Then, come along, this may interest you ;)</p><span id=continue-reading></span><h2 id=backstory><a aria-label="Anchor link for: backstory" class="header-anchor no-hover-padding" href=#backstory><span aria-hidden=true class=link-icon></span></a> Backstory</h2><p>I’ve been wanting to try <a href=http://docs.aws.amazon.com/lambda/latest/dg/welcome.html rel=noopener target=_blank>AWS Lambda</a> for a while. To be honest I’ve not yet done so due to laziness: my experience with AWS is that it needs more configuration and tweaking than I care for. Give me a <a href=https://www.heroku.com/ rel=noopener target=_blank>Heroku</a> any day (pros and cons, lengthy discussion for another day).<p>But going through my ‘list of stuff you should read’ I recently saw an <a href=http://underscore.io/blog/posts/2016/02/01/aws-lambda.html rel=noopener target=_blank>Underscore blog-post</a> by <a href=https://twitter.com/d6y rel=noopener target=_blank>Richard Dallaway</a>. AWS again, maybe it’s time to do something that uses it!<p>That got me started: sure there must be alternatives, something akin to “Heroku for Lambdas”? Yes, I’m aware AWS Lambdas are simple to use, but well, procrastination… So I started looking for options and I landed on a <a href=https://www.quora.com/Are-there-any-alternatives-to-Amazon-Lambda rel=noopener target=_blank>Quora question</a> which pointed me to <a href=https://webtask.io/ rel=noopener target=_blank>WebTask.io</a>.<h2 id=using-webtask><a aria-label="Anchor link for: using-webtask" class="header-anchor no-hover-padding" href=#using-webtask><span aria-hidden=true class=link-icon></span></a> Using WebTask</h2><p><a href=https://webtask.io/ rel=noopener target=_blank>WebTask.io</a> sounds exactly like what I was looking for. And, oh boy, it is simple to use!<p>I followed their instructions to install their <a href=https://webtask.io/cli rel=noopener target=_blank>cli</a>, which gives you a very intuitive command <code>wt</code> with options you’d expect (create, rm, ls). In just a few minutes I had my own endpoint running. Neat.<p>Now I needed something to test this a bit more. Enter <a href=https://en.wikipedia.org/wiki/Monkey_Island_(series) rel=noopener target=_blank>Monkey Island</a>. If you have played those games you most likely remember their <a href=http://monkeyisland.wikia.com/wiki/Insult_Sword_Fighting rel=noopener target=_blank>Insult Sword Fighting</a> scenes. Even if you didn’t play it you may know what they are, due to popularity in certain circles.<p>Implementing a service that given a specific insult returns the correct answer seemed like a very straightforward task that would let me test the service and find any obvious hurdles. So that’s what I built; you can get the code in <a href=https://github.com/pvillega/webtask-monkey-island rel=noopener target=_blank>my github repo</a>.<p>The service has a very basic behaviour:<ul><li>If you just call the endpoint (GET request), returns a random pair of insult-answer (in Json)<li>If you call the endpoint with an <code>insult</code> parameter it will return the correct response for that insult<li>If you call the endpoint with an invalid/unknown <code>insult</code> the response will notify you so</ul><p>The interaction is all via <code>GET</code> requests, and it returns <code>Json</code> (no <code>404</code> codes for invalid insults). As I said, a very basic implementation to test how hard is to use that service (note: not hard at all). Webkit provides the tools to implement all this properly, it’s just I didn’t use them ;)<h2 id=testing-the-service><a aria-label="Anchor link for: testing-the-service" class="header-anchor no-hover-padding" href=#testing-the-service><span aria-hidden=true class=link-icon></span></a> Testing the service</h2><p>I published a Webtask endpoint at:<pre class=z-code><code><span class="z-text z-plain">https://webtask.it.auth0.com/api/run/wt-pere_villega-gmail_com-0/sword-fight?webtask_no_cache=1 .
</span></code></pre><p>Be aware it is under a free plan, so it may be rate limited and disappear in 30 days. If you want to try it yourself, remember the sample code is available in <a href=https://github.com/pvillega/webtask-monkey-island rel=noopener target=_blank>my github repo</a>.<p>Let’s see how it works. If we run the request without any additional parameter, we should obtain a random pair of insult-response.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl https://webtask.it.auth0.com/api/run/wt-pere_villega-gmail_com-0/sword-fight<span class="z-constant z-character z-escape z-shell">\?</span>webtask_no_cache<span class="z-constant z-character z-escape z-shell">\=</span>1</span>
</span></code></pre><p>returns:<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">	</span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>received<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span></span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Nobody's ever drawn blood from me and nobody ever will.<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json">	</span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>answer<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span></span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>You run THAT fast?<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>We can provide a parameter with our <em>insult</em> to receive the right response:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl  https://webtask.it.auth0.com/api/run/wt-pere_villega-gmail_com-0/sword-fight<span class="z-keyword z-operator z-regexp z-quantifier z-shell">?</span>webtask_no_cache=1</span><span class="z-keyword z-operator z-logical z-job z-shell">&</span><span class="z-variable z-other z-readwrite z-assignment z-shell">insult</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">You<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span><span class="z-constant z-numeric z-integer z-decimal z-job z-shell">27</span></span>re<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span><span class="z-constant z-numeric z-integer z-decimal z-job z-shell">20</span></span>the<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span><span class="z-constant z-numeric z-integer z-decimal z-job z-shell">20</span></span>ugliest<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span><span class="z-constant z-numeric z-integer z-decimal z-job z-shell">20</span></span>monster<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span><span class="z-constant z-numeric z-integer z-decimal z-job z-shell">20</span></span>ever<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span><span class="z-constant z-numeric z-integer z-decimal z-job z-shell">20</span></span>created!</span>
</span></code></pre><p>which, as expected, returns:<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">	</span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>received<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span></span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>You're the ugliest monster ever created!<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json">	</span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>answer<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span></span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>If you don't count all the ones you've dated.<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>If we provide an insult that is not recognised, like:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl  https://webtask.it.auth0.com/api/run/wt-pere_villega-gmail_com-0/sword-fight<span class="z-keyword z-operator z-regexp z-quantifier z-shell">?</span>webtask_no_cache=1</span><span class="z-keyword z-operator z-logical z-job z-shell">&</span><span class="z-variable z-other z-readwrite z-assignment z-shell">insult</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">baka!</span>
</span></code></pre><p>the lambda complains:<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">	</span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>received<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span></span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>baka!<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json">	</span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>answer<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span></span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Incorrect insult!<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>Working as expected!<h1 id=future-work><a aria-label="Anchor link for: future-work" class="header-anchor no-hover-padding" href=#future-work><span aria-hidden=true class=link-icon></span></a> Future Work</h1><p>To be honest, I just wanted to dabble with this so I didn’t put much more effort into it. An obvious improvement is to allow the user to <em>fight</em> against the machine, although this would require preserving some state in the server-side.<p>Fortunately WebTask provides limited support for <a href=https://webtask.io/docs/storage rel=noopener target=_blank>storage</a>, which could be used to manage score for a given user, storing all the information in a map. But there’ll be concurrency issues with very low loads, so it may not be such a good idea after all. Something stateless like <a href=http://left-pad.io/ rel=noopener target=_blank>left-pad.io</a> fits the lambda model better ;)<p>As an aside, WebTask mentions in their documentation how their service can be used to enhance the security of your application by hiding api keys and other sensitive resources inside lambdas. It’s an interesting concept worth a bit of research, as it may be a good pattern to adapt in your standard deployment.<p>In any case, that’s all for now. As always, feedback via Twitter/Email is more than welcome. Cheers!</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://perevillega.com/posts/understanding-free-monads/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>On Free Monads</div><div><a aria-describedby=right_title aria-label=Prev href=https://perevillega.com/posts/scala-exchange-2015-day-two/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Scala Exchange 2015 Day Two</div></nav></article></main><script defer src=https://perevillega.com/js/mermaid.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://perevillega.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://perevillega.com/atom.xml rel=noopener target=_blank> <img alt=feed loading=lazy src=https://perevillega.com/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email=cHZpbGxlZ2ErYmxvZ0BhcmFjb24uY29t href=#><img alt=email loading=lazy src=https://perevillega.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://github.com/pvillega target=_blank> <img alt=github loading=lazy src=https://perevillega.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://gitlab.com/pvillega target=_blank> <img alt=gitlab loading=lazy src=https://perevillega.com/social_icons/gitlab.svg title=gitlab> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://bsky.app/profile/perevillega.com target=_blank> <img alt=bluesky loading=lazy src=https://perevillega.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://www.linkedin.com/in/perevillega/ target=_blank> <img alt=linkedin loading=lazy src=https://perevillega.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://stackoverflow.com/users/116791/pere-villega target=_blank> <img alt="stack overflow" title="stack overflow" loading=lazy src=https://perevillega.com/social_icons/stack-overflow.svg> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> & <a href=https://github.com/welpo/tabi rel=noopener target=_blank>tabi</a> </small></div></section><script async src=https://perevillega.com/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>