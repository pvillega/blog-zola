<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://perevillega.com name=base><title>Software serves the Business • Learning Shapeless</title><link href=https://perevillega.com/icons/favicon.ico rel=icon type=image/png><link title="Software serves the Business - Atom Feed" href=https://perevillega.com/atom.xml rel=alternate type=application/atom+xml><link href="https://perevillega.com/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://perevillega.com/main.css?h=149ff9e737409b86f9c3" rel=stylesheet><link href="https://perevillega.com/custom.css?h=ff5a5712d2f0bc9d9ac2" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=#087e96 name=theme-color><meta content="Shapeless is a type class and dependent type based generic programming library for Scala. It had its origins in several talks by Miles Sabin, and he has been the main contributor to the project.
…" name=description><meta content="Shapeless is a type class and dependent type based generic programming library for Scala. It had its origins in several talks by Miles Sabin, and he has been the main contributor to the project.
…" property=og:description><meta content="index, nofollow" name=robots><meta content="Learning Shapeless" property=og:title><meta content=article property=og:type><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" property=og:image><meta content=2088 property=og:image:width><meta content=1000 property=og:image:height><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" name=twitter:image><meta content=summary_large_image name=twitter:card><meta content=en_GB property=og:locale><meta content=https://perevillega.com/posts/learning-shapeless/ property=og:url><meta content="Software serves the Business" property=og:site_name><meta content="default-src 'self';font-src 'self' data: 'self';img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self' 'unsafe-inline';frame-src 'self' player.vimeo.com https://www.youtube-nocookie.com https://view.officeapps.live.com;connect-src 'self' https://umami.villegawilcz.com;script-src 'self' https://umami.villegawilcz.com 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://perevillega.com/no_js.css rel=stylesheet></noscript><script src=https://perevillega.com/js/initializeTheme.min.js></script><script defer src=https://perevillega.com/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=7bdfa858-bebc-479d-9a1f-bea833a709a8 defer src=https://umami.villegawilcz.com/script.js></script><meta content=@pvillega@mastodon.social name=fediverse:creator><script src="https://perevillega.com/search_index.en.js?h=5e3427c9b8d057d8989e" defer></script><script src="https://perevillega.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://perevillega.com>Software serves the Business</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/posts/> blog </a><li><a class="nav-links no-hover-padding" href=https://perevillega.com/tags/> tags </a></li><div class=nav-navs id=menu-icons-group><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Learning Shapeless</h1><ul class=meta><li>14th Nov 2016<li title="1306 words"><span aria-hidden=true class=separator>•</span>7 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://perevillega.com/tags/scala/>scala</a>, <li class=tag><a href=https://perevillega.com/tags/shapeless/>shapeless</a>, <li class=tag><a href=https://perevillega.com/tags/generic-programming/>generic programming</a></ul><section class=body><p><a href=https://github.com/milessabin/shapeless>Shapeless</a> is a type class and dependent type based generic programming library for Scala. It had its origins in several talks by <a href=https://twitter.com/milessabin>Miles Sabin</a>, and he has been the main contributor to the project.</p><span id=continue-reading></span><p>Within the community, <a href=https://github.com/milessabin/shapeless>Shapeless</a> is considered both as a stepping stone towards very advanced Scala constructs and a hard to learn (and to master) library. Unfortunately, Shapeless documentation is a bit sparse so users must find external resources to learn parts of the library.<p>My aim with this blog post is to provide a list of useful resources that may help you understand <a href=https://github.com/milessabin/shapeless>Shapeless</a> and how your project can benefit from using it.<h2 id=why-shapeless><a aria-label="Anchor link for: why-shapeless" class="header-anchor no-hover-padding" href=#why-shapeless><span aria-hidden=true class=link-icon></span></a> Why Shapeless</h2><p>First of all you may want to know what are the benefits of using Shapeless. Is it only relevant for library authors, or is it a library you want to use on your production codebase?<p>These <a href=https://speakerdeck.com/nigewarren/introduction-to-shapeless>slides</a> from <a href=https://twitter.com/nigewarren>Nigel Warren</a> show some realistic use cases for Shapeless. A short read that can give you an idea on what you could achieve with it.<p>This <a href="https://www.youtube.com/watch?v=JKaCCYZYBWo">video</a> from <a href="https://twitter.com/valentinkasas?lang=en">Valentin Kasas</a> at <a href=http://www.scalar-conf.com>Scalar 2016</a> shows a practical use case of Shapeless and HList, with example code.<p>The above links are introductions to the library and, as such, limited in scope. But you can already see a common theme, via the use of HList constructs: to provide a single implementation that works with all your types, instead of one implementation for every single type.<p>This approach has obvious advantages: less code means less bugs and less surface to be tested, while the fact it works for any case class makes the code more robust against new types introduced in the future.<p>I won't deny the type signatures are a bit off-putting, but that is a small price to pay for the flexibility you can obtain.<h2 id=a-business-case><a aria-label="Anchor link for: a-business-case" class="header-anchor no-hover-padding" href=#a-business-case><span aria-hidden=true class=link-icon></span></a> A Business Case</h2><p>Even after reading the links above you may still be a Shapeless skeptic, with the belief that is a tool with little benefit 'in the real world' (whatever that means to you). Confession time: I also was one, and it was a real-world issue at work what changed my mind.<p>The scenario is simple: we had a set of case classes representing different value types, and we needed to render them as Html, with reasonable expectations of adding many more types in the near future. So we wanted a simple way to convert exiting types plus any other type we would create later on.<p>If you have read some tutorials on Shapeless you may recognise this case as a common example to introduce some of the functionalities of the library, and this is so for a good reason: Shapeless excels at this task.<p>I am not allowed to publish all the code, but you can see a relevant snippet below:<pre class=language-scala data-lang=scala><code class=language-scala data-lang=scala>object ShowHtml {

  implicit val hnilEncoder: ShowHtml[HNil] =
    new ShowHtml[HNil] {
      def showHtml(t: HNil): NodeSeq = NodeSeq.Empty
    }

  implicit def hlistEncoder[H, T &LT: HList](
                            implicit
                            hEncoder: Lazy[ShowHtml[H]],
                            tEncoder: ShowHtml[T]
                          ): ShowHtml[H :: T] =
    new ShowHtml[H :: T] {
      def showHtml(hlist: H :: T): NodeSeq = hlist match {
        case h :: t => hEncoder.value.showHtml(h) ++ tEncoder.showHtml(t)
      }
    }

  implicit val cnilEncoder: ShowHtml[CNil] =
    new ShowHtml[CNil] {
      def showHtml(t: CNil): NodeSeq = NodeSeq.Empty
    }

  implicit def coproductEncoder[H, T &LT: Coproduct](
                    implicit
                    hEncoder: Lazy[ShowHtml[H]],
                    tEncoder: ShowHtml[T]
                  ): ShowHtml[H :+: T] =
    new ShowHtml[H :+: T] {
      def showHtml(hlist: H :+: T): NodeSeq = hlist match {
        case Inl(h) => hEncoder.value.showHtml(h)
        case Inr(t) => tEncoder.showHtml(t)
      }
    }

  implicit def genericEncoder[A, R](
                   implicit
                   gen: Generic.Aux[A, R],
                   enc: Lazy[ShowHtml[R]]
                 ): ShowHtml[A] =
    new ShowHtml[A] {
      def showHtml(a: A) = enc.value.showHtml(gen.to(a))
    }


  implicit def stringShow: ShowHtml[String] = new ShowHtml[String] {
    def showHtml(t: String): NodeSeq = &LTul>{t}&LT/ul>
  }

  implicit def booleanShow: ShowHtml[Boolean] = new ShowHtml[Boolean] {
    def showHtml(b: Boolean) = stringShow.showHtml(b.toString)
  }

  implicit def intShow: ShowHtml[Int] = new ShowHtml[Int] {
    def showHtml(n: Int) = stringShow.showHtml(n.toString)
  }
}
</code></pre><p>I won't explain the code itself, that's not the aim of this post and in any case it's not complete. What matters is that this snippet is the core of a fragment of code that thanks to methods <code>hlistEncoder</code>, <code>coproductEncoder</code>, and related definitions will convert any case class in the codebase to HTML. This includes any future case class we create later on, no changes required.<p>As a developer, it hardly gets better than this :)<h2 id=effortless-shapeless><a aria-label="Anchor link for: effortless-shapeless" class="header-anchor no-hover-padding" href=#effortless-shapeless><span aria-hidden=true class=link-icon></span></a> Effortless Shapeless</h2><p>You may not be convinced of the benefits of Shapeless (ok, keep reading then) or maybe you feel learning Shapeless requires an amount of effort and time you cannot spare. I have good news for you: you don't need to learn Shapeless to benefit from it.<p>If you browse the <a href=https://index.scala-lang.org/>Scala index</a> and search for <code>shapeless</code> you'll see a lot of results. Besides Shapeless itself you will find entries like:<ul><li><a href=https://index.scala-lang.org/alexarchambault/argonaut-shapeless>Argonaut Shapeless</a> which provides automatic derivation of codecs for your case classes<li><a href=https://index.scala-lang.org/typelevel/shapeless-contrib>Shapeless Contrib</a> which enables integration of Shapeless with libraries like Scalaz, which benefit from automatic derivation</ul><p>And many more. These libraries make your coding experience easier by leveraging shapeless. But you are not exposed to Shapeless itself, that's hidden from you. For example, <a href=https://index.scala-lang.org/alexarchambault/argonaut-shapeless>Argonaut Shapeless</a> provides json codecs for your case classes automatically. So, as per the library documentation, this just works:<pre class=language-scala data-lang=scala><code class=language-scala data-lang=scala>import argonaut._, Argonaut._, ArgonautShapeless._

sealed trait Base
case class First(i: Int) extends Base
case class Second(s: String) extends Base

// encoding
val encode = EncodeJson.of[Base]

val json = encode(First(2))
json.nospaces == """{"First":{"i":2}}"""

// decoding
val decode = DecodeJson.of[Base]

val result = decode.decodeJson(json)
result == DecodeResult.ok(First(2))
</code></pre><p>As you can see, no encoder nor decoder have been defined in the code, that being a tedious and repetitive task. Any new case class or ADT you add to your codebase benefits from this behaviour, automatically.<p>By using these libraries you will understand what Shapeless offers you much better, and they may be your 'gateway library' to learning Shapeless.<h2 id=learning-shapeless><a aria-label="Anchor link for: learning-shapeless" class="header-anchor no-hover-padding" href=#learning-shapeless><span aria-hidden=true class=link-icon></span></a> Learning Shapeless</h2><p>You have been convinced and want to learn Shapeless. Now what?<p>A while ago that would mean scouring lots of links and blog posts online, to find information about the most recent release of the library. Nowadays there is a much straightforward solution, thanks to <a href=https://twitter.com/davegurnell>Dave Gurnell</a> and <a href=http://underscore.io/>Underscore</a>: read the <a href=https://github.com/underscoreio/shapeless-guide>Shapeless book</a>.<p>Yes, there is a free ebook that explains how to use Shapeless, and it is a great book. Thanks Dave!<p>Not only that, but <a href=http://www.47deg.com/>47 Degrees</a> have released <a href=https://www.scala-exercises.org/>Scala Exercises</a>, a free website where you can practice some of the Shapeless concepts.<p>And for the cases not covered by <a href=https://www.scala-exercises.org/>Scala Exercises</a>, <a href=https://scalafiddle.io/>Scala Fiddle</a> allows you to select Shapeless as an available library (see <em>Libraries</em> section on the left-hand panel), so that you can test your Shapeless snippets online. Who needs an IDE?<p>This means you can easily read documentation on Shapeless and solve some exercises to test your newly acquired knowledge. What's your excuse? Go and start learning!<h2 id=additional-guides><a aria-label="Anchor link for: additional-guides" class="header-anchor no-hover-padding" href=#additional-guides><span aria-hidden=true class=link-icon></span></a> Additional Guides</h2><p>The existence of the <a href=https://github.com/underscoreio/shapeless-guide>Shapeless book</a> and <a href=https://www.scala-exercises.org/>Scala Exercises</a> makes learning Shapeless much easier, but I would be remiss if I dismissed other guides you can find online.<p>I find it very useful, when trying to learn a new and complex subject, to read many posts about the same idea. The repetition of the concepts breeds familiarity (hopefully without contempt!) with the concepts, and an array of examples allows for better understanding of the core ideas plus some of their nuances.<p>To this aim I recommend you to read the following posts, either before starting the book or as complementary documentation to flesh out the trickier concepts:<ul><li><a href=https://twitter.com/skaalf>Julien</a> wrote an <a href=http://jto.github.io/articles/getting-started-with-shapeless/>introduction to Shapeless</a> which describes (at a very high level) the main components of the library<li><a href=https://twitter.com/evacchi>Edoardo Vacchi</a> wrote a good <a href=http://rnduja.github.io/2016/01/19/a_shapeless_primer/>primer on Shapeless</a> that delves into a bit more detail than Julien's article.<li><a href=https://twitter.com/AKmetyuk>Anatolii Kmetiuk</a> wrote a couple of posts that describe both <a href=http://akmetiuk.com/blog/2016/09/30/dissecting-shapeless-hlists.html>HList</a> and <a href=http://akmetiuk.com/blog/2016/10/09/dissecting-shapeless-poly.html>Poly</a> in much more detail.<li><a href=https://twitter.com/vlpavkin>Vladimir Pavkin</a> shows how to <a href=http://pavkin.ru/implementing-typesafe-request-builder/>implement a typesafe request builder</a> using Shapeless, a more practical example.<li>And, lastly, if you want to see <a href=https://twitter.com/travisbrown>Travis Brown</a> doing some magic with Shapeless to solve a <a href="https://projecteuler.net/problem=2">Project Euler problem</a> please read <a href=http://stackoverflow.com/questions/31615371/scala-shapeless-code-for-project-euler-2/31640467#31640467>this stack overflow answer</a></ul><p>As mentioned, these links are complementary to the book but worth reading.<p>That's all for now, I hope this was informative and useful. As always, feedback via Twitter/Email is more than welcome. Cheers!</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://perevillega.com/posts/finch-underscore-post/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>Finch post at Underscore blog</div><div><a aria-describedby=right_title aria-label=Prev href=https://perevillega.com/posts/free-monads-and-stockfighter/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Free Monads and Stockfighter</div></nav></article></main><script defer src=https://perevillega.com/js/mermaid.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://perevillega.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://perevillega.com/atom.xml> <img alt=feed loading=lazy src=https://perevillega.com/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email=cHZpbGxlZ2ErYmxvZ0BhcmFjb24uY29t href=#><img alt=email loading=lazy src=https://perevillega.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/pvillega> <img alt=github loading=lazy src=https://perevillega.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://gitlab.com/pvillega> <img alt=gitlab loading=lazy src=https://perevillega.com/social_icons/gitlab.svg title=gitlab> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/perevillega.com> <img alt=bluesky loading=lazy src=https://perevillega.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/perevillega/> <img alt=linkedin loading=lazy src=https://perevillega.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://stackoverflow.com/users/116791/pere-villega> <img alt="stack overflow" title="stack overflow" loading=lazy src=https://perevillega.com/social_icons/stack-overflow.svg> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><script async src=https://perevillega.com/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>