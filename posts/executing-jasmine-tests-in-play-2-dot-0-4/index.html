<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://perevillega.com name=base><title>Software serves the Business • Executing Jasmine Tests in Play 2.0.4</title><link href=https://perevillega.com/icons/favicon.ico rel=icon type=image/png><link title="Software serves the Business - Atom Feed" href=https://perevillega.com/atom.xml rel=alternate type=application/atom+xml><link href="https://perevillega.com/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://perevillega.com/main.css?h=149ff9e737409b86f9c3" rel=stylesheet><link href="https://perevillega.com/custom.css?h=ff5a5712d2f0bc9d9ac2" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=#087e96 name=theme-color><meta content="Christmas break is over, and on a whim I started to check AngularJs. If you haven't tested it yet, do it. I've toyed around  with Backbone and some other Javascript single page app frameworks, and Angular is by far the one that I liked the most. It has simplicity embedded in its core, and turning tedious tasks (as setting controllers) into something trivial makes it a pleasure to use. Simplicity. Such an important concept, and one which is seldom present in frameworks.
…" name=description><meta content="Christmas break is over, and on a whim I started to check AngularJs. If you haven't tested it yet, do it. I've toyed around  with Backbone and some other Javascript single page app frameworks, and Angular is by far the one that I liked the most. It has simplicity embedded in its core, and turning tedious tasks (as setting controllers) into something trivial makes it a pleasure to use. Simplicity. Such an important concept, and one which is seldom present in frameworks.
…" property=og:description><meta content="index, nofollow" name=robots><meta content="Executing Jasmine Tests in Play 2.0.4" property=og:title><meta content=article property=og:type><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" property=og:image><meta content=2088 property=og:image:width><meta content=1000 property=og:image:height><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" name=twitter:image><meta content=summary_large_image name=twitter:card><meta content=en_GB property=og:locale><meta content=https://perevillega.com/posts/executing-jasmine-tests-in-play-2-dot-0-4/ property=og:url><meta content="Software serves the Business" property=og:site_name><meta content="default-src 'self';font-src 'self' data: 'self';img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self' 'unsafe-inline';frame-src 'self' player.vimeo.com https://www.youtube-nocookie.com https://view.officeapps.live.com;connect-src 'self' https://umami.villegawilcz.com;script-src 'self' https://umami.villegawilcz.com 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://perevillega.com/no_js.css rel=stylesheet></noscript><script src=https://perevillega.com/js/initializeTheme.min.js></script><script defer src=https://perevillega.com/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=7bdfa858-bebc-479d-9a1f-bea833a709a8 defer src=https://umami.villegawilcz.com/script.js></script><meta content=@pvillega@mastodon.social name=fediverse:creator><script src="https://perevillega.com/search_index.en.js?h=5e3427c9b8d057d8989e" defer></script><script src="https://perevillega.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://perevillega.com>Software serves the Business</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/posts/> blog </a><li><a class="nav-links no-hover-padding" href=https://perevillega.com/tags/> tags </a></li><div class=nav-navs id=menu-icons-group><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Executing Jasmine Tests in Play 2.0.4</h1><ul class=meta><li>26th Jan 2013<li title="880 words"><span aria-hidden=true class=separator>•</span>5 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://perevillega.com/tags/scala/>scala</a>, <li class=tag><a href=https://perevillega.com/tags/play2/>play2</a>, <li class=tag><a href=https://perevillega.com/tags/playframework/>playframework</a>, <li class=tag><a href=https://perevillega.com/tags/angularjs/>angularjs</a>, <li class=tag><a href=https://perevillega.com/tags/jasmine/>jasmine</a></ul><section class=body><p><em>Christmas</em> break is over, and on a whim I started to check <a href=http://angularjs.org/>AngularJs</a>. If you haven't tested it yet, do it. I've toyed around with Backbone and some other Javascript <em>single page app</em> frameworks, and Angular is by far the one that I liked the most. It has simplicity embedded in its core, and turning tedious tasks (as setting controllers) into something trivial makes it a pleasure to use. Simplicity. Such an important concept, and one which is seldom present in frameworks.</p><span id=continue-reading></span><p>But I digress. Back to the post. Adding Angular to a Play app is as simple as you can imagine, as in the end it's a Javascript library. Add the Angular files, code controllers and services, put Angular templates under <code>public</code> so Angular can get them, and you are done. You can see a project sample <a href=https://github.com/pvillega/play2demo-jasmine>in my Github account</a>. Be aware the sample is very rough and has minimal functionality, the aim was to see how can they be linked, not to push Angular boundaries.<p>So we have a Javascript framework, and obviously we want to test it. Unfortunately the recommended way to test Angular is via <a href=http://pivotal.github.com/jasmine/>Jasmine</a>, a Javascript BDD framework. I say unfortunately because that would mean running 2 commands for testing: one for Play tests and another for Angular tests. Or does it?<p>It is on moments like this when Open Source shows its worthiness. Enter <a href=http://www.guardian.co.uk/>The Guardian</a> and its Software development department, which open sources a lot of the code they create to run their online platform. A wise company, they use Scala and Play and they created <a href=https://github.com/guardian/sbt-jasmine-plugin>Sbt-Jasmine</a>, a plugin to run Jasmine inside Sbt projects. Given that Play 2 uses Sbt, this should prove simple.<p>Well, to be honest it wasn't <em>so</em> simple, that's why I decided to document it here to save time to other interested people. This assumes a working Play 2.0.4 project, should work with any 2.0.x project but can't promise anything about 2.1 (have to test it yet)<h2 id=integrating-sbt-jasmine><a aria-label="Anchor link for: integrating-sbt-jasmine" class="header-anchor no-hover-padding" href=#integrating-sbt-jasmine><span aria-hidden=true class=link-icon></span></a> Integrating Sbt-Jasmine</h2><p>This is quite straightforward, you just need to follow the instructions from the <a href=https://github.com/guardian/sbt-jasmine-plugin>Sbt-Jasmine</a> page. On your project, under the <code>project</code> folder, create another folder named <code>project</code> (that is, you will have <code>/project/project/</code> path). Inside that new folder create a file <code>Plugins.scala</code> and add this code to it:<pre class=language-scala data-lang=scala><code class=language-scala data-lang=scala>
import sbt._


// This plugin is used to load the sbt-jasmine plugin into our project.
// This allows us to import the SbtJasminePlugin file
// in Build.scala, and then set the settings and configuration for Sbt-Jasmine
object Plugins extends Build {
  lazy val plugins = Project("plugins", file("."))
    .dependsOn(uri("git://github.com/guardian/sbt-jasmine-plugin.git#0.7"))
}
</code></pre><p>This will load the plugin directly from Github into your project.<h2 id=adding-jasmine-as-part-of-your-test-cycle><a aria-label="Anchor link for: adding-jasmine-as-part-of-your-test-cycle" class="header-anchor no-hover-padding" href=#adding-jasmine-as-part-of-your-test-cycle><span aria-hidden=true class=link-icon></span></a> Adding Jasmine as part of your test cycle</h2><p>Now that we have the plugin in, we want to be able to run both test types (Play and Jasmine) when executing <code>play test</code>. To that aim we have to edit our <code>Build.scala</code> project file to let Play know about Jasmine.<p>The first step will be importing the existing Jasmine settings the sbt plugin added into the project. We can do that via the <code>PlayProject</code> method <code>settings</code>, as in <code>.settings(jasmineSettings : _*)</code><p>The second step is to override the default Jasmine configuration, specifically the paths that point to the test assets and source files. Sbt-Jasmine expects a set of default paths that don't map to the ones existing in a Play project, so we change them as follows:<pre class=language-scala data-lang=scala><code class=language-scala data-lang=scala>

// jasmine configuration, overridden as we don't follow the default
// project structure sbt-jasmine expects

appJsDir <+= baseDirectory / "app/assets/javascripts",
appJsLibDir <+= baseDirectory / "public/javascripts/lib",
jasmineTestDir <+= baseDirectory / "test/assets/",
jasmineConfFile <+= baseDirectory / "test/assets/test.dependencies.js",

</code></pre><p>Note that <code>appJsDir</code> is pointing to the folder for minimized assets, we could change that to point to <code>"public/Javascripts"</code>. The paths for <code>appJsLibDir</code>, <code>jasmineTestDir</code> and <code>jasmineConfFile</code> can be modified as it suits you.<p>The Jasmine configuration file follows standard Jasmine notation, which I won't discuss in this post. The configuration for this sample project is:<pre class=language-scala data-lang=scala><code class=language-scala data-lang=scala>
// Dependencies for the unit test via Jasmine
EnvJasmine.loadGlobal(EnvJasmine.libDir + "jquery-1.8.3.min.js");
EnvJasmine.loadGlobal(EnvJasmine.libDir + "angular.min.js");
EnvJasmine.loadGlobal(EnvJasmine.libDir + "angular-resource.min.js");
EnvJasmine.loadGlobal(EnvJasmine.testDir + "config/angular-mocks.js");

// Import all modules (RequireJs fails for some reason)
// FIXME: check why we can't use RequireJs
EnvJasmine.loadGlobal(EnvJasmine.rootDir + "todo.js");

</code></pre><p>Finally we need to tell Play to run Jasmine tests when executing the <code>test</code> command. We do this by adding a dependency on <code>test</code> with <code>(test in Test) <<= (test in Test) dependsOn (jasmine)</code>. This will cause Play to run first the Jasmine tests and, if they succeed, Play own tests will be executed.<p>The final code looks like:<pre class=language-scala data-lang=scala><code class=language-scala data-lang=scala>
val main = PlayProject(appName, appVersion,
 appDependencies, mainLang = SCALA)
//this adds jasmine settings from the sbt-jasmine plugin into the project
.settings(jasmineSettings : _*)
.settings(

  // Add your own project settings here

  // jasmine configuration overridden
  appJsDir <+= baseDirectory / "app/assets/javascripts",
  appJsLibDir <+= baseDirectory / "public/javascripts/lib",
  jasmineTestDir <+= baseDirectory / "test/assets/",
  jasmineConfFile <+= baseDirectory / "test/assets/test.dependencies.js",

  // link jasmine to the standard 'sbt test' action.
  // Now when running 'test' jasmine tests will be run
  // and after that other Play tests will be executed.
  (test in Test) <<= (test in Test) dependsOn (jasmine)
)

</code></pre><p>And that's all. If you add some Jasmine tests under <code>test/assets</code> and then execute <code>play test</code> you will see them being run. Remember what I said about simplicity? Why should you remember to run 2 suits independently when 1 command can do that for you?<h2 id=to-be-improved><a aria-label="Anchor link for: to-be-improved" class="header-anchor no-hover-padding" href=#to-be-improved><span aria-hidden=true class=link-icon></span></a> To be improved</h2><p>As much as I would like, this is not perfect. I found a couple of issues when integrating Jasmine and Play. Given I'm not an expert on neither, any help will be appreciated:<ul><li><p>In theory you could use <a href=http://requirejs.org/>RequireJS</a> to import the Javascript sources to test, but it didn't work when I tried. Not sure why and for a standard AngularJs distribution we are talking about 5 Javascript files (it could grow if you break them into components), so it doesn't seem such a big deal. But it's not perfect.</p><li><p>AngularJs allows you to declare End to End test scenarios, similar to Selenium but inside AngularJs itself. Unfortunately I couldn't make them work, as they require a server running. Given the enhanced Selenium support in newer AngularJS versions I expect one could use Play end to end scenarios to test this part, but I need to put more work on it to ensure it is true.</p></ul><p>If anyone knows how to fix this, please let me know!</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://perevillega.com/posts/using-redis-pubsub-with-play-2-dot-1-0/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>Using Redis PubSub with Play 2.1.0</div><div><a aria-describedby=right_title aria-label=Prev href=https://perevillega.com/posts/iteratees-and-play-2/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Iteratees and Play 2</div></nav></article></main><script defer src=https://perevillega.com/js/mermaid.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://perevillega.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://perevillega.com/atom.xml> <img alt=feed loading=lazy src=https://perevillega.com/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email=cHZpbGxlZ2ErYmxvZ0BhcmFjb24uY29t href=#><img alt=email loading=lazy src=https://perevillega.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/pvillega> <img alt=github loading=lazy src=https://perevillega.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://gitlab.com/pvillega> <img alt=gitlab loading=lazy src=https://perevillega.com/social_icons/gitlab.svg title=gitlab> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/perevillega.com> <img alt=bluesky loading=lazy src=https://perevillega.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/perevillega/> <img alt=linkedin loading=lazy src=https://perevillega.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://stackoverflow.com/users/116791/pere-villega> <img alt="stack overflow" title="stack overflow" loading=lazy src=https://perevillega.com/social_icons/stack-overflow.svg> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><script async src=https://perevillega.com/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>