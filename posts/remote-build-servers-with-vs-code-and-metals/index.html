<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://perevillega.com name=base><title>Software serves the Business • Using a remote server to build your Scala projects</title><link href=https://perevillega.com/icons/favicon.ico rel=icon type=image/png><link title="Software serves the Business - Atom Feed" href=https://perevillega.com/atom.xml rel=alternate type=application/atom+xml><link href="https://perevillega.com/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://perevillega.com/main.css?h=149ff9e737409b86f9c3" rel=stylesheet><link href="https://perevillega.com/custom.css?h=ff5a5712d2f0bc9d9ac2" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=#087e96 name=theme-color><meta content="VS Code has released tooling for remote development via ssh. In Scala the combo of Metals and VS Code for development has become the norm for many people. How easy and convenient may it be to use them while on ssh with a remote server? Let's discover it.
…" name=description><meta content="VS Code has released tooling for remote development via ssh. In Scala the combo of Metals and VS Code for development has become the norm for many people. How easy and convenient may it be to use them while on ssh with a remote server? Let's discover it.
…" property=og:description><meta content="index, nofollow" name=robots><meta content="Using a remote server to build your Scala projects" property=og:title><meta content=article property=og:type><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" property=og:image><meta content=2088 property=og:image:width><meta content=1000 property=og:image:height><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" name=twitter:image><meta content=summary_large_image name=twitter:card><meta content=en_GB property=og:locale><meta content=https://perevillega.com/posts/remote-build-servers-with-vs-code-and-metals/ property=og:url><meta content="Software serves the Business" property=og:site_name><meta content="default-src 'self';font-src 'self' data: 'self';img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self' 'unsafe-inline';frame-src 'self' player.vimeo.com https://www.youtube-nocookie.com https://view.officeapps.live.com;connect-src 'self' https://umami.villegawilcz.com;script-src 'self' https://umami.villegawilcz.com 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://perevillega.com/no_js.css rel=stylesheet></noscript><script src=https://perevillega.com/js/initializeTheme.min.js></script><script defer src=https://perevillega.com/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=7bdfa858-bebc-479d-9a1f-bea833a709a8 defer src=https://umami.villegawilcz.com/script.js></script><meta content=@pvillega@mastodon.social name=fediverse:creator><script src="https://perevillega.com/search_index.en.js?h=5e3427c9b8d057d8989e" defer></script><script src="https://perevillega.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://perevillega.com>Software serves the Business</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/posts/> blog </a><li><a class="nav-links no-hover-padding" href=https://perevillega.com/tags/> tags </a></li><div class=nav-navs id=menu-icons-group><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Using a remote server to build your Scala projects</h1><ul class=meta><li>9th May 2020<li title="2146 words"><span aria-hidden=true class=separator>•</span>11 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://perevillega.com/tags/scala/>scala</a>, <li class=tag><a href=https://perevillega.com/tags/sbt/>sbt</a>, <li class=tag><a href=https://perevillega.com/tags/vscode/>vscode</a>, <li class=tag><a href=https://perevillega.com/tags/linode/>linode</a>, <li class=tag><a href=https://perevillega.com/tags/triplequote/>triplequote</a></ul><section class=body><p>VS Code has released tooling <a href=https://code.visualstudio.com/docs/remote/ssh>for remote development via ssh</a>. In Scala the combo of <a href=https://scalameta.org/metals/>Metals</a> and <a href=https://code.visualstudio.com/>VS Code</a> for development has become the norm for many people. How easy and convenient may it be to use them while on ssh with a remote server? Let's discover it.</p><span id=continue-reading></span><h2 id=why-would-someone-do-that><a aria-label="Anchor link for: why-would-someone-do-that" class="header-anchor no-hover-padding" href=#why-would-someone-do-that><span aria-hidden=true class=link-icon></span></a> Why would someone do that</h2><p>First of all we should tackle an obvious question: why would a developer do that? The answer is that there are many valid scenarios for this approach:<ul><li>someone may work in a big corporation that gives lower-end Windows laptops, but has several servers available for developers to use<li>someone may not have enough budget to replace their aging laptop, and it is looking at the cloud as a cheaper alternative<li>an employer has Intellectual Property concerns and would like tight controls on where is the codebase cloned to<li>a developer uses mainly a desktop and they don't want to buy a powerful laptop, but recently they need to travel more and still code<li>a developer is fed up with seeing iStats show 90+ C degrees on the cpu sensor of their laptop, sustained while sbt compiles the project</ul><p>Or, if none of them applies, just because we can. We'll talk about cost-effectiveness of this approach towards the end of the post.<h2 id=setting-up-your-environment><a aria-label="Anchor link for: setting-up-your-environment" class="header-anchor no-hover-padding" href=#setting-up-your-environment><span aria-hidden=true class=link-icon></span></a> Setting up your environment</h2><p>To make this work you will need:<ul><li>a local machine capable of running Visual Studio Code.<li>a remote server, preferably with Linux (we use Ubuntu 20.04 LTS).<li>to read and follow the steps in this post, adapting as needed if you use a different OS on your remote host.</ul><p>The requirements for Visual Studio Code <a href=https://code.visualstudio.com/Docs/supporting/requirements>are quite low</a>, remember that the heavy lifting (compiling) won't be done in the local machine, so even old laptops should work fine.<p>Ideally you have some internet exposed desktop or server that you can use as the remote host. If you don't have any at hand, look at a VPS service like <a href=https://www.linode.com>Linode</a> or <a href=https://www.hetzner.com/>Hetzner</a>. We'd recommend against AWS or GCP as they seem to be more expensive for worse performance. This post will use Linode, for no other reason that we used it in the past and we were happy with it. No affiliation with the brand.<p>Important note: if you are creating a new account in a VPS, expect to provide a valid credit card number to cover for the costs of any usage. There may also be a delay while they verify your account details; a new account via a UK-based Ltd company with Linode took 30m to be verified.<h2 id=creating-your-remote-developer-instance><a aria-label="Anchor link for: creating-your-remote-developer-instance" class="header-anchor no-hover-padding" href=#creating-your-remote-developer-instance><span aria-hidden=true class=link-icon></span></a> Creating your remote developer instance</h2><p>First of all, provision an instance for the server if you need it. We use <code>Linode Dedicated CPU</code> instances as they are supposed to have better CPU performance. You can follow <a href=https://www.linode.com/docs/platform/dedicated-cpu/getting-started-with-dedicated-cpu/>these steps</a> to create one. We chose the following settings:<ul><li>OS: Ubuntu 20.04 LTS<li>Region: London<li>Plan: Dedicated 8 Gb (4 cores, 8 Gb RAM)<li>Provide root password and ssh key for your local machine</ul><p>Provisioning takes around one minute, and then you can ssh into the box with <code>ssh root@&LTip></code>.<p>Important note: on new accounts with Linode, you need to open a ticket with support to enable Dedicated 16 Gb and Dedicated 32 Gb Linode for your account. Otherwise you won't be allowed to create those instances. Other VPS may have similar rules.<p>Once the machine is up, ssh into it. The next step is to install a valid JDK. You can use <a href=https://medium.com/adoptopenjdk/adoptopenjdk-rpm-and-deb-files-7003ba38144e>Adopt OpenJDK</a> by running the following:<pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>> wget -qO - https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public | sudo apt-key add
> add-apt-repository --yes https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/
> apt-get update
> apt-get install adoptopenjdk-11-hotspot
</code></pre><p>Then edit your <code>.profile</code> and add an export for <code>JAVA_HOME</code> to it:<pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>export JAVA_HOME='/usr/lib/jvm/adoptopenjdk-11-hotspot-amd64/'
</code></pre><p>We also want to increase the number of file descriptors available to avoid issues with VS Code and large projects. To that end, edit <code>/etc/sysctl.conf</code> and add to the bottom of the file <code>fs.inotify.max_user_watches=524288</code> and run <code>sysctl -p</code> to reapply the changes.<p>We also want <code>sbt</code> and <code>npm</code> (for <code>scala.js</code>), which we can install as follows:<pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>> echo "deb https://dl.bintray.com/sbt/debian /" | sudo tee -a /etc/apt/sources.list.d/sbt.list
> apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2EE0EA64E40A89B84B2DF73499E82A75642AC823
> apt-get update
> apt-get -y install sbt npm
</code></pre><p>To be able to work with Github, you will need to add the ssh public key of this instance to your profile. To generate a key, run:<pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>> ssh-keygen -t rsa -b 4096 -C "your_email@example.com"  # don't add a password
> cat ~/.ssh/id_rsa.pub
</code></pre><p>Copy the output of the last command and add it to your SSH key list in Github.<p>As the last step, clone the repository of <code>cats</code> so that we can run some tests on it later:<pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>git clone git@github.com:typelevel/cats.git
</code></pre><p>With these, your remote server should be ready to run scala code. As the next step, we need to connect a VS Code instance to it.<h2 id=connecting-visual-studio-code><a aria-label="Anchor link for: connecting-visual-studio-code" class="header-anchor no-hover-padding" href=#connecting-visual-studio-code><span aria-hidden=true class=link-icon></span></a> Connecting Visual Studio Code</h2><p>Open your VS Code and install the extension <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh">Remote - SSH</a>. Then follow the <a href=https://code.visualstudio.com/docs/remote/ssh>official documentation</a> to connect to the remote server:<ul><li>open the <code>Remote Explorer</code> menu and add your server<li>once configured, you can <code>connect</code> to the server. This will open a new VS Code window. The bottom panel will show (on the left side) that you are connected to a remote server<li>extensions are (usually) installed on the server, which means you will need to reinstall Metals. Open the <code>Extensions</code> panel, in there you will see that extensions are split between <code>local</code> and <code>ssh</code>. Scroll the <code>local</code> list and press the green <code>install in ssh</code> button for all those extensions you want to enable on your remote machine.<li>if you haven't done so, search for <code>Metals</code> and install it. Then reload the window.<li>Edit VS Code settings for Metals, on the <code>ssh</code> section for your remote machine set the proper path for <code>Java Home</code> in <code>Metals</code> (see previous section of this post for the path). This will require another reload of VS Code.</ul><p>If you installed the <code>Live Share</code> extension, you may be prompted to install additional components, which requires yet another window refresh.<h2 id=loading-your-project><a aria-label="Anchor link for: loading-your-project" class="header-anchor no-hover-padding" href=#loading-your-project><span aria-hidden=true class=link-icon></span></a> Loading your project</h2><p>Once the VS Code window has reloaded and reconnected to the server, you can just go to <code>File > Open</code> and select the <code>cats</code> project you cloned when setting up the server. Metals will let you know that this is an <code>sbt</code> project and it will request to load it.<p>That's it. Once Metals completes the set up, you are ready to go and code as you are used to.<p>Important: Note that any <code>terminal</code> you open while in the <code>ssh</code> window will open directly in the remote server.<h2 id=backing-up-your-remote-server><a aria-label="Anchor link for: backing-up-your-remote-server" class="header-anchor no-hover-padding" href=#backing-up-your-remote-server><span aria-hidden=true class=link-icon></span></a> Backing up your remote server</h2><p>At this point you want to create an image of your server. Note that Linode (and most other platforms) will still charge you for the box if you stop it, as it is still provisioned for you.<p>To reduce costs what you want is to have an image with the latest changes to your server, which you can do <a href=https://www.linode.com/docs/platform/disk-images/linode-images/>following these steps</a>. Building the image took less than 2 minutes for our server. Once you have the image, you can delete your instance and create a new one when needed, using that image as a starting point. The image will keep the same ssh public key, which means you can interact with Github using your account without any additional steps.<p>Note that in Linode you have some restrictions on images but even so this should be enough for your purposes. Alternatively, you could use <a href=https://www.linode.com/docs/platform/stackscripts/>Stack Scripts</a> or some other automated system to create images on demand.<h2 id=performance><a aria-label="Anchor link for: performance" class="header-anchor no-hover-padding" href=#performance><span aria-hidden=true class=link-icon></span></a> Performance</h2><p>Now that we have everything set up, we need to verify how fast is this setup. How does it compare to running everything locally? To test this we downloaded <a href=https://github.com/typelevel/cats>cats</a> and we run <code>;clean;test</code> in <code>sbt</code> a few times. The following is a completely non-scientific table of the measurements:<table><thead><tr><th>Machine<th style=text-align:right>Avg<tbody><tr><td>Macbook 16" late 2019 (8 cores)<td style=text-align:right>3:28<tr><td>Linode 4 cores<td style=text-align:right>Error<tr><td>Linode 8 cores<td style=text-align:right>11:48<tr><td>Linode 16 cores<td style=text-align:right>4:46</table><p>All Linode instances are 'Dedicated CPU' instances. On the 'Linode 4' instance,<code>sbt</code> was often killed by the OS when running alongside VS Code.<p>Let's be realistic, the performance is worse. The fastest Linode test, using the 16 cores machine, is over 1 minute slower than a test using a local environment. Unless you have a remote server you own and with a decent cpu, you are going to lose at least some performance. But it's not too terrible.<h2 id=enter-hydra><a aria-label="Anchor link for: enter-hydra" class="header-anchor no-hover-padding" href=#enter-hydra><span aria-hidden=true class=link-icon></span></a> Enter Hydra</h2><p>Remember that we are trying to find a way to run compilation in remote servers for cases where a local setup is not an option. Maybe we can improve on it? <a href=https://triplequote.com>Triplequote</a> offers <code>Hydra</code>, a parallel compiler for Scala. This would increase costs, but can this turn it into a viable alternative?<p>We followed the <a href=https://docs.triplequote.com/trial/sbt/>instructions for a trial</a> with <code>Hydra</code> and we run the tests again in Linode. The trial license uses a <code>Developer (Enterprise)</code> license which can take advantage of up to 8 cores.<table><thead><tr><th>Machine (with Hydra)<th style=text-align:right>Avg<tbody><tr><td>Linode 8 cores<td style=text-align:right>6:39<tr><td>Linode 16 cores<td style=text-align:right>1:30</table><p>We can see Hydra makes a big difference as it is able to take advantage of the number of cores available. In the lower spec Linode we halve the compile time, while in the Linode with 16 cores we compile cats in a third of the time it originally took. The improvements would be similar in a local setup, but let's remember that we are looking at scenarios where you need (want) to use a remote setup.<h2 id=cost-of-the-setup><a aria-label="Anchor link for: cost-of-the-setup" class="header-anchor no-hover-padding" href=#cost-of-the-setup><span aria-hidden=true class=link-icon></span></a> Cost of the setup</h2><p>A MacBook Pro 16" 2019, with the maximum RAM (64 Gb) and CPU (8 core 2.4 Ghz) currently costs $3,799.00, taxes aside. Other non-Apple laptops and desktops will be cheaper, but I use this as a reference as it is the one many companies give to their developers, so it is a fair benchmark for comparison.<p>A Linode (Dedicated CPU) with 8 cores and 16 Gb RAM costs USD0.18/hour. For a standard work schedule of 45h per week and 50 weeks per year (and you should really work less than that), it adds up to USD8.1 per week, and USD405 for the year. Assuming the same use pattern, a Linode with 16 cores and 32 Gb of RAM (USD0.36/hr) costs twice as much: $16.2 per week, USD910 per year.<p>A <code>Developer - Enterprise</code> license for <code>Hydra</code> costs $1,080/year per seat, to take advantage of up to 8 cores.<p>The slower Linode with 8 cores, with Hydra, would cost $1,485/year but it is twice as slow as the laptop we compare it with, which makes it a less appealing choice. Without Hydra the compilation times become too high to even consider it as an option.<p>But with the Linode 16 cores the story changes, as the performance is closer to what we get with a local machine. You could pay USD910 for the Linode instance and get compile times around 30% slower, but at 25% of the cost of the laptop. Or, if you add Hydra and increase the cost to USD1,990, you can be 60% faster than the laptop for around 50% of the price.<h2 id=conclusions><a aria-label="Anchor link for: conclusions" class="header-anchor no-hover-padding" href=#conclusions><span aria-hidden=true class=link-icon></span></a> Conclusions</h2><p>Is it cloud computing ready to become your development server? As with most things in development, it depends. If you need to squeeze every bit of performance from your machines, then a local setup is still preferred. And you should get a Hydra license, period.<p>But if not, you can get reasonable performance from dedicated machines. A Linode with 16 cores and without Hydra is a quarter of the price of a top of the shelf laptop, and you still get reasonable performance. If you add Hydra on top, then we are looking at remote setups that outperform a local setup, while costing you less upfront. A hard-to-beat proposition.<p>There are multiple caveats, of course. For example, the SSH extension for Visual Studio Code is still on <code>preview</code> and there may be glitches. Also, things that are easily achieved with a local workflow may be slightly more complicated with a remote one.<p>But not many project will be as demanding as <code>cats</code> for compilation, due to its multiple compile targets. And there are other possible benefits, like being to replace docker services running locally by ones in remote servers, reducing pressure on the computer even more. Given that we would expect costs for cloud computing to decrease as time goes by, this setup can only become better as time goes by. Yes, it is unlikely to beat a local setup on raw performance, but sometimes that is not the only constraint.<p>That's all for now, I hope this was informative and useful. As always, feedback via Twitter/Email is more than welcome. Cheers!</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://perevillega.com/posts/shadow-it-chaordic/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>Chaordic collaboration: Why you have Shadow IT</div><div><a aria-describedby=right_title aria-label=Prev href=https://perevillega.com/posts/webassembly-rust-edge-computing/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>WebAssembly, Rust, and Edge Computing</div></nav></article></main><script defer src=https://perevillega.com/js/mermaid.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://perevillega.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://perevillega.com/atom.xml> <img alt=feed loading=lazy src=https://perevillega.com/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email=cHZpbGxlZ2ErYmxvZ0BhcmFjb24uY29t href=#><img alt=email loading=lazy src=https://perevillega.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/pvillega> <img alt=github loading=lazy src=https://perevillega.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://gitlab.com/pvillega> <img alt=gitlab loading=lazy src=https://perevillega.com/social_icons/gitlab.svg title=gitlab> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/perevillega.com> <img alt=bluesky loading=lazy src=https://perevillega.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/perevillega/> <img alt=linkedin loading=lazy src=https://perevillega.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://stackoverflow.com/users/116791/pere-villega> <img alt="stack overflow" title="stack overflow" loading=lazy src=https://perevillega.com/social_icons/stack-overflow.svg> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><script async src=https://perevillega.com/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>