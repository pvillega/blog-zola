<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://perevillega.com name=base><title>Software serves the Business • Using Ansible to deploy Play Framework apps in EC2 instances</title><link href=https://perevillega.com/icons/favicon.ico rel=icon type=image/png><link title="Software serves the Business - Atom Feed" href=https://perevillega.com/atom.xml rel=alternate type=application/atom+xml><link href="https://perevillega.com/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://perevillega.com/main.css?h=149ff9e737409b86f9c3" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=#087e96 name=theme-color><meta content="TL;DR: Clone Ansible for Play Framework to automate the task of deploying Play 2.x projects from a git repository into an EC2 instance.
As many developers I’m not a good sysadmin. That’s why I was happy to see the raise of PaaS like Heroku, which facilitated deploying a webapp without having to spend time in sysadmin tasks which I didn’t know how to do correctly and which took me too much time.
…" name=description><meta content="TL;DR: Clone Ansible for Play Framework to automate the task of deploying Play 2.x projects from a git repository into an EC2 instance.
As many developers I’m not a good sysadmin. That’s why I was happy to see the raise of PaaS like Heroku, which facilitated deploying a webapp without having to spend time in sysadmin tasks which I didn’t know how to do correctly and which took me too much time.
…" property=og:description><meta content="index, nofollow" name=robots><meta content="Using Ansible to deploy Play Framework apps in EC2 instances" property=og:title><meta content=article property=og:type><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" property=og:image><meta content=2088 property=og:image:width><meta content=1000 property=og:image:height><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" name=twitter:image><meta content=summary_large_image name=twitter:card><meta content=en_GB property=og:locale><meta content=https://perevillega.com/posts/using-ansible-to-deploy-play-framework-apps-in-ec2-instances/ property=og:url><meta content="Software serves the Business" property=og:site_name><meta content="default-src 'self';font-src 'self' data: 'self';img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self' 'unsafe-inline';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self' https://umami.villegawilcz.com;script-src 'self' https://umami.villegawilcz.com 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://perevillega.com/no_js.css rel=stylesheet></noscript><script src=https://perevillega.com/js/initializeTheme.min.js></script><script defer src=https://perevillega.com/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=7bdfa858-bebc-479d-9a1f-bea833a709a8 defer src=https://umami.villegawilcz.com/script.js></script><meta content=@pvillega@mastodon.social name=fediverse:creator><script src="https://perevillega.com/search_index.en.js?h=791a6da9678059241bea" defer></script><script src="https://perevillega.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://perevillega.com>Software serves the Business</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/posts/> blog </a><li><a class="nav-links no-hover-padding" href=https://perevillega.com/tags/> tags </a></li><div class=nav-navs id=menu-icons-group><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Using Ansible to deploy Play Framework apps in EC2 instances</h1><ul class=meta><li>1st Apr 2013<li title="740 words"><span aria-hidden=true class=separator>•</span>4 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://perevillega.com/tags/scala/>scala</a>, <li class=tag><a href=https://perevillega.com/tags/play2/>play2</a>, <li class=tag><a href=https://perevillega.com/tags/ansible/>ansible</a>, <li class=tag><a href=https://perevillega.com/tags/ec2/>ec2</a></ul><section class=body><p><strong>TL;DR:</strong> Clone <a href=https://github.com/pvillega/ansible-ec2-play rel=noopener target=_blank>Ansible for Play Framework</a> to automate the task of deploying Play 2.x projects from a git repository into an EC2 instance.<p>As many developers I’m not a good sysadmin. That’s why I was happy to see the raise of PaaS like <a href=http://www.heroku.com/ rel=noopener target=_blank>Heroku</a>, which facilitated deploying a webapp without having to spend time in sysadmin tasks which I didn’t know how to do correctly and which took me too much time.</p><span id=continue-reading></span><p>Unfortunately, as with most abstractions, the PaaS environments are simple to use but also quite limited in options. Heroku offering of 512Mb per dyno plus limitations on what you can do can be a problem, and the third party addons get expensive quickly. Then you have Amazon EC2, cheaper and quite flexible, but in exchange you need a bit more of “sysadmin knowledge”. Not a big deal for apps like this blog, running in a Micro instance, but if your app is bigger and spans several servers, it may become time consuming.<p>I wanted to automate the task of managing the server so I did not have to worry too much about it. I looked at both <a href=http://www.opscode.com/chef/ rel=noopener target=_blank>Chef</a> and <a href=https://puppetlabs.com/ rel=noopener target=_blank>Puppet</a>, but somehow I couldn’t bring myself to spend enough time with them. The release of <a href=http://aws.amazon.com/opsworks/ rel=noopener target=_blank>Amazon OpsWorks</a> raised the issue again as they don’t have a Play Framework 2 script ready out of the box, but it was hard to try to focus on that task.<p>That was it until this last weekend when I discovered, somehow, <a href=http://ansible.cc/ rel=noopener target=_blank>Ansible</a>. Ansible is a tool in the same category as Chef and Puppet (purists will start pointing at relevant differences here, but I only care about the fact that they automate my sysadmin tasks). For some reason Ansible seemed much simpler to understand and use, and I got hooked. Ansible Playbooks consist on a series of yaml files that declare the steps to execute, in order. Ansible itself manages the execution of the steps across servers, so you can run one script on as many servers as you need all at the same time. I won’t enter into details as <a href=http://ansible.cc/ rel=noopener target=_blank>Ansible</a> has good enough documentation, but to put an example let’s see a possible Ansible Playbook to install <code>Authbind</code> into an EC2 instance:<pre class=z-code><code><span class="z-text z-plain">    # Run with: ansible-playbook -i hosts.ini playenv.yaml -u ubuntu
</span><span class="z-text z-plain">    ---
</span><span class="z-text z-plain">    - hosts: ec2Instance
</span><span class="z-text z-plain">      vars:
</span><span class="z-text z-plain">      - ubuntu_release: quantal
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">    tasks:
</span><span class="z-text z-plain">      - name: Install Authbind
</span><span class="z-text z-plain">        action: apt pkg=authbind state=latest install_recommends=yes
</span></code></pre><p>Having the tool the task ahead was clear: my main 3 sysadmin issues with EC2 (given my current usage level) are securing the Ubuntu AMI, deploying a Play environment and deploying the app itself. With Ansible, I should be able to automate these steps so I won’t do mistakes like forgetting one step as well as reducing the time I have to spend on these tasks.<p>It wasn’t easy (as I said I’m not a sysadmin) and the scripts could be better, but I managed to create something that works: <a href=https://github.com/pvillega/ansible-ec2-play rel=noopener target=_blank>Ansible for Play Framework in EC2</a>. Instructions for execution are included in the Github repository.<p>There are 3 relevant scripts:<ul><li><p><strong>bootstrap.yaml:</strong> runs a series of commands to enhance security of an EC2 Ubuntu AMI. I’m not a sysadmin so some step may be wrong or incomplete, but what’s in there seems to work fine. Requires sudo privilege in the target machine to run.</p><li><p><strong>playenv.yaml:</strong> sets some Play Framework dependencies (basically pvm and java 7) as well as Authbind so Play can use port 80 without root privileges. Requires sudo privilege in the target machine to run.</p><li><p><strong>deploy.yaml:</strong> clones a Play project from a given Git repository and deploys it on the target machine. The script assumes the repository contains a <code>start</code> file in the format provided with the script (see <code>exec</code> folder) to be able to successfully launch the app. Customise the <code>start</code> file as required. No sudo required, the script uses authbind to link Play to port 80. Be aware that in EC2 Micro instances this script will fail due to low memory as Linux memory manager kills the JVM when building the distributable zip for the app.</p></ul><p>If you have a project in Github (or any publicly available Git repository) and an EC2 instance, run the scripts through Ansible and there you go, app deployed and running!<p>So, that’s all. If you see something that can be improved, please contribute with a pull request. I hope with this you can save some time on your next deployment.</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://perevillega.com/posts/scala-in-2018/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>Scala in 2018</div><div><a aria-describedby=right_title aria-label=Prev href=https://perevillega.com/posts/using-redis-pubsub-with-play-2-dot-1-0/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Using Redis PubSub with Play 2.1.0</div></nav></article></main><script defer src=https://perevillega.com/js/mermaid.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://perevillega.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://perevillega.com/atom.xml rel=noopener target=_blank> <img alt=feed loading=lazy src=https://perevillega.com/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email=cHZpbGxlZ2ErYmxvZ0BhcmFjb24uY29t href=#><img alt=email loading=lazy src=https://perevillega.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://github.com/pvillega target=_blank> <img alt=github loading=lazy src=https://perevillega.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://gitlab.com/pvillega target=_blank> <img alt=gitlab loading=lazy src=https://perevillega.com/social_icons/gitlab.svg title=gitlab> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://bsky.app/profile/perevillega.com target=_blank> <img alt=bluesky loading=lazy src=https://perevillega.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://www.linkedin.com/in/perevillega/ target=_blank> <img alt=linkedin loading=lazy src=https://perevillega.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://stackoverflow.com/users/116791/pere-villega target=_blank> <img alt="stack overflow" title="stack overflow" loading=lazy src=https://perevillega.com/social_icons/stack-overflow.svg> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> & <a href=https://github.com/welpo/tabi rel=noopener target=_blank>tabi</a> </small></div></section><script async src=https://perevillega.com/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>