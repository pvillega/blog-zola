<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://perevillega.com name=base><title>Software serves the Business • Free Monads using FreeK</title><link href=https://perevillega.com/icons/favicon.ico rel=icon type=image/png><link title="Software serves the Business - Atom Feed" href=https://perevillega.com/atom.xml rel=alternate type=application/atom+xml><link href="https://perevillega.com/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://perevillega.com/main.css?h=149ff9e737409b86f9c3" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=#087e96 name=theme-color><meta content="My previous post on Free Monad implemented a few DSL using Free Monads. The same day I published it I discovered FreeK by Pascal Voitot. How does FreeK help you when building a Free Monad?
…" name=description><meta content="My previous post on Free Monad implemented a few DSL using Free Monads. The same day I published it I discovered FreeK by Pascal Voitot. How does FreeK help you when building a Free Monad?
…" property=og:description><meta content="index, nofollow" name=robots><meta content="Free Monads using FreeK" property=og:title><meta content=article property=og:type><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" property=og:image><meta content=2088 property=og:image:width><meta content=1000 property=og:image:height><meta content="https://perevillega.com/social_cards/index.png?h=125d02cc3c86eaf88fa6" name=twitter:image><meta content=summary_large_image name=twitter:card><meta content=en_GB property=og:locale><meta content=https://perevillega.com/posts/freek-and-free-monads/ property=og:url><meta content="Software serves the Business" property=og:site_name><meta content="default-src 'self';font-src 'self' data: 'self';img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self' 'unsafe-inline';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self' https://umami.villegawilcz.com;script-src 'self' https://umami.villegawilcz.com 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://perevillega.com/no_js.css rel=stylesheet></noscript><script src=https://perevillega.com/js/initializeTheme.min.js></script><script defer src=https://perevillega.com/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=7bdfa858-bebc-479d-9a1f-bea833a709a8 defer src=https://umami.villegawilcz.com/script.js></script><meta content=@pvillega@mastodon.social name=fediverse:creator><script src="https://perevillega.com/search_index.en.js?h=791a6da9678059241bea" defer></script><script src="https://perevillega.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://perevillega.com>Software serves the Business</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/posts/> blog </a><li><a class="nav-links no-hover-padding" href=https://perevillega.com/tags/> tags </a></li><div class=nav-navs id=menu-icons-group><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Free Monads using FreeK</h1><ul class=meta><li>30th May 2016<li title="1026 words"><span aria-hidden=true class=separator>•</span>6 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://perevillega.com/tags/scala/>scala</a>, <li class=tag><a href=https://perevillega.com/tags/monad/>monad</a>, <li class=tag><a href=https://perevillega.com/tags/fp/>fp</a>, <li class=tag><a href=https://perevillega.com/tags/free-monad/>free monad</a>, <li class=tag><a href=https://perevillega.com/tags/freek/>freek</a></ul><section class=body><p>My previous post on <a href=/understanding-free-monads>Free Monad</a> implemented a few DSL using Free Monads. The same day I published it I discovered <a href=https://github.com/ProjectSeptemberInc/freek rel=noopener target=_blank>FreeK</a> by <a href=https://twitter.com/mandubian rel=noopener target=_blank>Pascal Voitot</a>. How does FreeK help you when building a Free Monad?</p><span id=continue-reading></span><p>I’ve updated my <a href=https://github.com/pvillega/free-monad-sample rel=noopener target=_blank>code</a> on Free Monad with a sample using FreeK. The sample contains my previous implementation which only used <a href=http://typelevel.org/cats/tut/freemonad.html rel=noopener target=_blank>Cats</a> Free implementation, so you can compare both side by side.<p>I can say upfront that FreeK removed a bit of <em>boilerplate</em> and made the implementation slightly cleaner. I feel the main benefit of FreeK is not so much the Free Monad tooling (which, don’t misunderstand me, is good!) but it’s integration with monad transformers, as well as the way it manages what Pascal calls <em>monadic onions of result types</em>.<h2 id=implementing-free-with-freek><a aria-label="Anchor link for: implementing-free-with-freek" class="header-anchor no-hover-padding" href=#implementing-free-with-freek><span aria-hidden=true class=link-icon></span></a> Implementing Free with FreeK</h2><p>The first step is, as expected, to define our languages. I assume (from now onwards) that you have read <a href=/understanding-free-monads>my previous post</a> so I won’t discuss details already tackled in there.<p>With FreeK we define our language like this:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> Orders</span></span> <span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">sealed</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">trait</span><span class="z-entity z-name z-class z-scala"> DSL</span></span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> ListStocks</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">List</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Symbol</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> Buy</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">stock</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Symbol</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">amount</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-storage z-type z-primitive z-scala">Int</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Response</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> Sell</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">stock</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Symbol</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">amount</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-storage z-type z-primitive z-scala">Int</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Response</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-end z-scala">}</span></span>
</span></code></pre><p>which is no different as how we were doing it before; a trait with case classes. The convention of calling the trait <code>DSL</code> and embedding it in the object is one I’ll use from now on, but it’s not exclusive of <em>FreeK</em>, can be used without it.<p>An interpreter is defined as:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> OrderInterpreter</span></span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-punctuation z-definition z-parens z-begin z-scala">(</span><span class="z-support z-class z-scala">Orders</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">~></span> <span class="z-support z-class z-scala">Id</span><span class="z-punctuation z-definition z-parens z-end z-scala">)</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-meta z-import z-scala"><span class="z-keyword z-other z-import z-scala">import</span> Orders<span class="z-punctuation z-accessor z-dot z-scala">.</span><span class="z-variable z-language z-underscore z-scala">_</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-storage z-type z-function z-scala">def</span> <span class="z-entity z-name z-function z-scala">apply</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">a</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Orders</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> a <span class="z-keyword z-control z-flow z-scala">match</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala">    <span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">ListStocks</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Getting list of stocks: FB, TWTR<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      <span class="z-support z-constant z-scala">List</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>FB<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>TWTR<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Buy</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">stock</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">amount</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Buying </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">amount</span><span class="z-string z-quoted z-interpolated z-scala"> of </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">stock</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ok<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Sell</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">stock</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">amount</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Selling </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">amount</span><span class="z-string z-quoted z-interpolated z-scala"> of </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">stock</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ok<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">  </span><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></code></pre><p>which, again, is an alternative to the way we were defining interpreters before. Not <em>FreeK</em> exclusive, but nicer :)<p>So let’s define the rest of our languages:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> Log dsl</span>
</span><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> Log</span></span> <span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">sealed</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">trait</span><span class="z-entity z-name z-class z-scala"> DSL</span></span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> Info</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">msg</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">String</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-storage z-type z-primitive z-scala">Unit</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> Error</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">msg</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">String</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-storage z-type z-primitive z-scala">Unit</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-end z-scala">}</span></span>
</span><span class="z-source z-scala">
</span><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> Defining the interpreter for Log</span>
</span><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> LogInterpreter</span></span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-punctuation z-definition z-parens z-begin z-scala">(</span><span class="z-support z-class z-scala">Log</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">~></span> <span class="z-support z-class z-scala">Id</span><span class="z-punctuation z-definition z-parens z-end z-scala">)</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-meta z-import z-scala"><span class="z-keyword z-other z-import z-scala">import</span> Log<span class="z-punctuation z-accessor z-dot z-scala">.</span><span class="z-variable z-language z-underscore z-scala">_</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-storage z-type z-function z-scala">def</span> <span class="z-entity z-name z-function z-scala">apply</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">a</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Log</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> a <span class="z-keyword z-control z-flow z-scala">match</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala">    <span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Info</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">msg</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>[Info] - </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">msg</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Error</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">msg</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>[Error] - </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">msg</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">  </span><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span><span class="z-source z-scala">
</span><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> Audit dsl</span>
</span><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> Audit</span></span> <span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">sealed</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">trait</span><span class="z-entity z-name z-class z-scala"> DSL</span></span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> UserAction</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">user</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">UserId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">action</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">String</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">values</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">List</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Values</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-storage z-type z-primitive z-scala">Unit</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> SystemAction</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">job</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">JobId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">action</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">String</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">values</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">List</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Values</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-storage z-type z-primitive z-scala">Unit</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-end z-scala">}</span></span>
</span><span class="z-source z-scala">
</span><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> Audit interpreter</span>
</span><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> AuditInterpreter</span></span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-punctuation z-definition z-parens z-begin z-scala">(</span><span class="z-support z-class z-scala">Audit</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">~></span> <span class="z-support z-class z-scala">Id</span><span class="z-punctuation z-definition z-parens z-end z-scala">)</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-meta z-import z-scala"><span class="z-keyword z-other z-import z-scala">import</span> Audit<span class="z-punctuation z-accessor z-dot z-scala">.</span><span class="z-variable z-language z-underscore z-scala">_</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-storage z-type z-function z-scala">def</span> <span class="z-entity z-name z-function z-scala">apply</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">a</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Audit</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> a <span class="z-keyword z-control z-flow z-scala">match</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala">    <span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">UserAction</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">user</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">action</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">values</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>[USER Action] - user </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">user</span><span class="z-string z-quoted z-interpolated z-scala"> called </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">action</span><span class="z-string z-quoted z-interpolated z-scala"> with values </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">values</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">SystemAction</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">job</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">action</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">values</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>[SYSTEM Action] - </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">job</span><span class="z-string z-quoted z-interpolated z-scala"> called </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">action</span><span class="z-string z-quoted z-interpolated z-scala"> with values </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">values</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">  </span><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span><span class="z-source z-scala">
</span><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> Messaging dsl</span>
</span><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> Messaging</span></span> <span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">sealed</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">trait</span><span class="z-entity z-name z-class z-scala"> DSL</span></span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> Publish</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">channelId</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">ChannelId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">source</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">SourceId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">messageId</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">MessageId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">message</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">String</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Response</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala">  <span class="z-storage z-modifier z-other z-scala">final</span> <span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">case </span><span class="z-storage z-type z-class z-scala">class</span><span class="z-entity z-name z-class z-scala"> Subscribe</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">channelId</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">ChannelId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">filterBy</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Condition</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-entity z-other z-inherited-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">Payload</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-class z-body z-scala"><span class="z-punctuation z-section z-braces z-end z-scala">}</span></span>
</span><span class="z-source z-scala">
</span><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> Messaging interpreter</span>
</span><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> MessagingInterpreter</span></span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-punctuation z-definition z-parens z-begin z-scala">(</span><span class="z-support z-class z-scala">Messaging</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">~></span> <span class="z-support z-class z-scala">Id</span><span class="z-punctuation z-definition z-parens z-end z-scala">)</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-meta z-import z-scala"><span class="z-keyword z-other z-import z-scala">import</span> Messaging<span class="z-punctuation z-accessor z-dot z-scala">.</span><span class="z-variable z-language z-underscore z-scala">_</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-storage z-type z-function z-scala">def</span> <span class="z-entity z-name z-function z-scala">apply</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">a</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Messaging</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> a <span class="z-keyword z-control z-flow z-scala">match</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala">    <span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Publish</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">channelId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">source</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">messageId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">message</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Publish [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">channelId</span><span class="z-string z-quoted z-interpolated z-scala">] From: [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">source</span><span class="z-string z-quoted z-interpolated z-scala">] Id: [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">messageId</span><span class="z-string z-quoted z-interpolated z-scala">] Payload: [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">message</span><span class="z-string z-quoted z-interpolated z-scala">]<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ok<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Subscribe</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">channelId</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">filterBy</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      <span class="z-storage z-type z-stable z-scala">val</span> <span class="z-variable z-other z-constant z-scala">payload</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Event fired<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Received message from [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">channelId</span><span class="z-string z-quoted z-interpolated z-scala">] (filter: [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">filterBy</span><span class="z-string z-quoted z-interpolated z-scala">]): [</span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">payload</span><span class="z-string z-quoted z-interpolated z-scala">]<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      <span class="z-support z-constant z-scala">List</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span>payload<span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">  </span><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></code></pre><p>Ok, languages defined. Next, let’s define our <em>Free</em> type (or <em>Coproduct</em> for multiple types)<h2 id=the-free-coproduct-type><a aria-label="Anchor link for: the-free-coproduct-type" class="header-anchor no-hover-padding" href=#the-free-coproduct-type><span aria-hidden=true class=link-icon></span></a> The Free/Coproduct type</h2><p>In here is where <em>FreeK</em> provides the first big improvement. <em>FreeK</em> contains a specialised implementation of Shapeless <code>Coproduct</code> for higher-kinded structures. The result is that we can define a type that includes several languages in one go, instead of having to create the chain of <code>Coproduct</code> we built in the previous post.<p>With <em>FreeK</em> you use the same syntax for a Free that includes one or several languages:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-storage z-type z-scala">type</span> <span class="z-entity z-name z-type z-scala">PRGOne</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span> <span class="z-keyword z-operator z-assignment z-scala">= </span><span class="z-punctuation z-definition z-group z-begin z-scala">(</span><span class="z-support z-class z-scala">Log</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">:|:</span> <span class="z-support z-class z-scala">FXNil</span><span class="z-punctuation z-definition z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">#</span><span class="z-support z-class z-scala">Cop</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala"><span class="z-comment z-line z-double-slash z-scala"><span class="z-punctuation z-definition z-comment z-scala">//</span> PRG is the one we will use in our code</span>
</span><span class="z-source z-scala"><span class="z-storage z-type z-scala">type</span> <span class="z-entity z-name z-type z-scala">PRG</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span> <span class="z-keyword z-operator z-assignment z-scala">= </span><span class="z-punctuation z-definition z-group z-begin z-scala">(</span><span class="z-support z-class z-scala">Log</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">:|:</span> <span class="z-support z-class z-scala">Audit</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">:|:</span> <span class="z-support z-class z-scala">Orders</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">:|:</span> <span class="z-support z-class z-scala">FXNil</span><span class="z-punctuation z-definition z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">#</span><span class="z-support z-class z-scala">Cop</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span></code></pre><p>Interpreters get a similar benefit. You can leverage <em>FreeK</em> specific syntax to easily compose interpreters from multiple languages. The only restrictions are:<ul><li>the interpreters must all be transformations to the same Monad (as with any composition of Natural Transformations, nothing new here)<li>they must be declared in the same order the types are defined in our <code>PRG</code> declaration.</ul><pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-storage z-type z-stable z-scala">val</span> <span class="z-variable z-other z-constant z-scala">interpreter</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Interpreter</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-class z-scala">Id</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> <span class="z-support z-constant z-scala">LogInterpreter</span> :|: <span class="z-support z-constant z-scala">AuditInterpreter</span> :|: <span class="z-support z-constant z-scala">OrderInterpreter</span>
</span></code></pre><p>With this we have our <em>free type</em> and the <em>interpreter</em>. That was easy! We just need the program to execute, and we are done.<h2 id=the-program><a aria-label="Anchor link for: the-program" class="header-anchor no-hover-padding" href=#the-program><span aria-hidden=true class=link-icon></span></a> The program</h2><p>If you have noticed, in the previous post we created some kind of support methods that lifted our case classes to a Free Monad. But this time we have not built anything similar. So, how are we going to use our case classes in a for-comprehension?<p>The answer is given by *FreeK and a support method appropriately called <code>freek[A]</code>. Let’s see an example of its usage by replicating the logic in our original program:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-storage z-type z-stable z-scala">val</span> <span class="z-variable z-other z-constant z-scala">program</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Free</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-class z-scala">Response</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> <span class="z-keyword z-control z-flow z-scala">for</span> <span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Info</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>I'm going to trade smartly<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">UserAction</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ID102<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>buy<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">List</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>APPL<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>100<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Buy</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>APPL<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-constant z-numeric z-integer z-decimal z-scala">200</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Info</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>I'm going to trade even more smartly<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">UserAction</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ID102<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>buy<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">List</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>MSFT<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>100<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Buy</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>MSFT<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-constant z-numeric z-integer z-decimal z-scala">100</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">UserAction</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ID102<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>sell<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">List</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>GOOG<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>100<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-parameter z-scala">rsp</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Sell</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>GOOG<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-constant z-numeric z-integer z-decimal z-scala">300</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">SystemAction</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>BACKOFFICE<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>tradesCheck<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">List</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>ID102<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>lastTrades<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">      <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Error</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Wait, what?!<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">    <span class="z-punctuation z-section z-block z-end z-scala">}</span> <span class="z-keyword z-control z-flow z-scala">yield</span> rsp
</span></code></pre><p>As you can see we are using the case classes we defined with our languages, directly. The magic happens within the <code>freek[PRG]</code> call, which lifts our case class to a Free Monad of the <code>Coproduct</code> defined by <code>PRG</code>.<p>We have replaced support methods using <code>Free.liftF</code> or <code>Inject</code> with this call, which some people may argue is not a huge benefit, code wise. Personally, I believe it’s a big win as we have less clutter around our languages, where now we just see case classes and interpreters, and all the extra syntax is located within the program itself. Also, adding new languages is much simpler. What’s not to like?<p>We can execute this program to verify it works:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala">println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Use interpreter on `program`: <span class="z-punctuation z-definition z-expression z-scala">${</span></span><span class="z-source z-scala z-embedded">program<span class="z-punctuation z-accessor z-scala">.</span>foldMap<span class="z-punctuation z-section z-group z-begin z-scala">(</span>interpreter<span class="z-punctuation z-accessor z-scala">.</span>nat<span class="z-punctuation z-section z-group z-end z-scala">)</span></span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-expression z-scala">}</span><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></code></pre><p>Oh, by the way, remember that program that was returning a <code>List</code> inside the monad, and thus required the use of traverse? Yes, we can also implement it using <em>FreeK</em>:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-storage z-type z-stable z-scala">val</span> <span class="z-variable z-other z-constant z-scala">programWithList</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Free</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-class z-scala">Response</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> <span class="z-keyword z-control z-flow z-scala">for</span> <span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span><span class="z-source z-scala">  <span class="z-variable z-parameter z-scala">st</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">ListStocks</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala">  <span class="z-variable z-language z-underscore z-scala">_</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> st<span class="z-punctuation z-accessor z-scala">.</span>traverseU<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-support z-constant z-scala">Buy</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-language z-underscore z-scala">_</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-constant z-numeric z-integer z-decimal z-scala">100</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span><span class="z-source z-scala">  <span class="z-variable z-parameter z-scala">rsp</span> <span class="z-keyword z-operator z-assignment z-scala">&LT-</span> <span class="z-support z-constant z-scala">Sell</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>GOOG<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-constant z-numeric z-integer z-decimal z-scala">100</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>freek<span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span>
</span><span class="z-source z-scala"><span class="z-punctuation z-section z-block z-end z-scala">}</span> <span class="z-keyword z-control z-flow z-scala">yield</span> rsp
</span></code></pre><p>We still need the <code>traverseU</code> trick, but it works the same, as <code>freek[PRG]</code> returns a monad an that fits the signature of <code>traverseU</code>. So we can port our programs, we are not losing any core functionality by using <em>FreeK</em>.<h2 id=orders-via-messages><a aria-label="Anchor link for: orders-via-messages" class="header-anchor no-hover-padding" href=#orders-via-messages><span aria-hidden=true class=link-icon></span></a> Orders via Messages</h2><p>The last use case explored in the previous post was to define <code>Orders</code> as a set of <code>Messaging</code> operations, by chaining natural transformations from <code>Orders</code>, to <code>Messaging</code>, and to <code>Id</code>. Can we do this with <em>FreeK</em>? Let’s start by defining a new interpreter from <code>Orders</code> to <code>Messaging</code>:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-meta z-class z-identifier z-scala"><span class="z-storage z-type z-class z-scala">object</span><span class="z-entity z-name z-class z-scala"> OrdersToMessagesInterpreter</span></span> <span class="z-keyword z-declaration z-scala">extends</span> <span class="z-punctuation z-definition z-parens z-begin z-scala">(</span><span class="z-support z-class z-scala">Orders</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span> <span class="z-support z-type z-scala">~></span> <span class="z-support z-class z-scala">Messaging</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span><span class="z-punctuation z-definition z-parens z-end z-scala">)</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-meta z-import z-scala"><span class="z-keyword z-other z-import z-scala">import</span> Orders<span class="z-punctuation z-accessor z-dot z-scala">.</span><span class="z-variable z-language z-underscore z-scala">_</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-meta z-import z-scala"><span class="z-keyword z-other z-import z-scala">import</span> Messaging<span class="z-punctuation z-accessor z-dot z-scala">.</span><span class="z-variable z-language z-underscore z-scala">_</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala">  <span class="z-storage z-type z-function z-scala">def</span> <span class="z-entity z-name z-function z-scala">apply</span><span class="z-meta z-generic z-scala"><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span></span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">a</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Orders</span><span class="z-punctuation z-accessor z-scala">.</span><span class="z-support z-class z-scala">DSL</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">A</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> <span class="z-keyword z-operator z-assignment z-scala">=</span> a <span class="z-keyword z-control z-flow z-scala">match</span> <span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-begin z-scala">{</span>
</span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala">    <span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">ListStocks</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      <span class="z-support z-constant z-scala">Publish</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>001<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Orders<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">UUID</span><span class="z-punctuation z-accessor z-scala">.</span>randomUUID<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>toString<span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Get Stocks List<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">      <span class="z-support z-constant z-scala">Subscribe</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>001<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>*<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Buy</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">stock</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">amount</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      <span class="z-support z-constant z-scala">Publish</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>001<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Orders<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">UUID</span><span class="z-punctuation z-accessor z-scala">.</span>randomUUID<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>toString<span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Buy </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">stock</span><span class="z-string z-quoted z-interpolated z-scala"> </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">amount</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">    </span><span class="z-keyword z-other z-declaration z-scala">case</span><span class="z-meta z-pattern z-scala"> <span class="z-support z-constant z-scala">Sell</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-variable z-parameter z-scala">stock</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-variable z-parameter z-scala">amount</span><span class="z-punctuation z-section z-group z-end z-scala">)</span> </span><span class="z-storage z-type z-function z-arrow z-case z-scala">=></span><span class="z-meta z-block z-case z-non-first z-scala">
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">      <span class="z-support z-constant z-scala">Publish</span><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>001<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-double z-scala"><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Orders<span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-constant z-scala">UUID</span><span class="z-punctuation z-accessor z-scala">.</span>randomUUID<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-punctuation z-section z-group z-end z-scala">)</span><span class="z-punctuation z-accessor z-scala">.</span>toString<span class="z-punctuation z-separator z-scala">,</span> <span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Sell </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">stock</span><span class="z-string z-quoted z-interpolated z-scala"> </span><span class="z-punctuation z-definition z-variable z-scala"><span class="z-variable z-other z-scala">$</span></span><span class="z-variable z-other z-scala">amount</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></span></span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-scala"><span class="z-meta z-block z-case z-non-first z-scala">  </span><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></span><span class="z-source z-scala"><span class="z-meta z-block z-scala"><span class="z-punctuation z-section z-block z-end z-scala">}</span></span>
</span></code></pre><p>Next step, let’s integrate this interpreter into the interpreter chain we defined before. To do this, we need to replace <code>OrderInterpreter</code> by a composition of the new interpreter (from <code>Orders</code> to <code>Messaging</code>) and the existing interpreter from <code>Messaging</code> to <code>Id</code>:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala"><span class="z-storage z-type z-stable z-scala">val</span> <span class="z-variable z-other z-constant z-scala">interpreterWithMessaging</span><span class="z-punctuation z-ascription z-scala">:</span> <span class="z-support z-class z-scala">Interpreter</span><span class="z-punctuation z-definition z-generic z-begin z-scala">[</span><span class="z-support z-class z-scala">PRG</span><span class="z-punctuation z-separator z-scala">,</span> <span class="z-support z-class z-scala">Id</span><span class="z-punctuation z-definition z-generic z-end z-scala">]</span> <span class="z-keyword z-operator z-assignment z-scala">=</span>
</span><span class="z-source z-scala">  <span class="z-support z-constant z-scala">LogInterpreter</span> :|: <span class="z-support z-constant z-scala">AuditInterpreter</span> :|: <span class="z-meta z-group z-scala"><span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-support z-constant z-scala">MessagingInterpreter</span> compose <span class="z-support z-constant z-scala">OrdersToMessagesInterpreter</span><span class="z-punctuation z-section z-group z-end z-scala">)</span></span>
</span></code></pre><p>and then we run our program:<pre class="language-scala z-code" data-lang=scala><code class=language-scala data-lang=scala><span class="z-source z-scala">println<span class="z-punctuation z-section z-group z-begin z-scala">(</span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-support z-function z-scala">s</span><span class="z-punctuation z-definition z-string z-begin z-scala">"</span>Use interpreter with Messaging on `program`: <span class="z-punctuation z-definition z-expression z-scala">${</span></span><span class="z-source z-scala z-embedded">program<span class="z-punctuation z-accessor z-scala">.</span>foldMap<span class="z-punctuation z-section z-group z-begin z-scala">(</span>interpreterWithMessaging<span class="z-punctuation z-accessor z-scala">.</span>nat<span class="z-punctuation z-section z-group z-end z-scala">)</span></span><span class="z-string z-quoted z-interpolated z-scala"><span class="z-punctuation z-definition z-expression z-scala">}</span><span class="z-punctuation z-definition z-string z-end z-scala">"</span></span><span class="z-punctuation z-section z-group z-end z-scala">)</span>
</span></code></pre><p>It works, so it seems we can do what we expected! Can’t we?<p>Well, the astute reader (i.e.: one that has read up to this point… congratulations!) will notice that in our previous implementation we were using a for-comprehension in <code>OrdersToMessagesInterpreter</code> for the case of <code>ListStocks</code>. As we are working with case classes directly, not with monads, we can’t build the for-comprehension.<p>I’ve tried to work around it by creating some additional types to lift the classes via <code>freek[A]</code>, so we can have the same code as before, but it’s become a bit verbose which means that, most likely, I’m doing something wrong :) Just be aware this use case may require a bit more effort than the others.<h2 id=in-summary><a aria-label="Anchor link for: in-summary" class="header-anchor no-hover-padding" href=#in-summary><span aria-hidden=true class=link-icon></span></a> In summary</h2><p>I like <em>FreeK</em>, as it simplifies working with Free Monads. There may be a couple of scenarios which need either more work or a better understanding of the library, but in general it seems like a robust solutions. Let’s not forget it also provides utilities to mix monad transformers with our Free monads, which will solve several pains related to monad stacks.<p>So if you want to use Free monads in our code, please give <em>Freek</em> a go :)<p>That’s all for now, I hope this was informative and useful. As always, feedback via Twitter/Email is more than welcome. Cheers!</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://perevillega.com/posts/free-monads-and-stockfighter/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>Free Monads and Stockfighter</div><div><a aria-describedby=right_title aria-label=Prev href=https://perevillega.com/posts/understanding-free-monads/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>On Free Monads</div></nav></article></main><script defer src=https://perevillega.com/js/mermaid.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://perevillega.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://perevillega.com/atom.xml rel=noopener target=_blank> <img alt=feed loading=lazy src=https://perevillega.com/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email=cHZpbGxlZ2ErYmxvZ0BhcmFjb24uY29t href=#><img alt=email loading=lazy src=https://perevillega.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://github.com/pvillega target=_blank> <img alt=github loading=lazy src=https://perevillega.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://gitlab.com/pvillega target=_blank> <img alt=gitlab loading=lazy src=https://perevillega.com/social_icons/gitlab.svg title=gitlab> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://bsky.app/profile/perevillega.com target=_blank> <img alt=bluesky loading=lazy src=https://perevillega.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://www.linkedin.com/in/perevillega/ target=_blank> <img alt=linkedin loading=lazy src=https://perevillega.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://stackoverflow.com/users/116791/pere-villega target=_blank> <img alt="stack overflow" title="stack overflow" loading=lazy src=https://perevillega.com/social_icons/stack-overflow.svg> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://perevillega.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> & <a href=https://github.com/welpo/tabi rel=noopener target=_blank>tabi</a> </small></div></section><script async src=https://perevillega.com/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>